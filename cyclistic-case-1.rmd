{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "be122ea9",
   "metadata": {
    "_cell_guid": "b1076dfc-b9ad-4769-8c92-a6c4dae69d19",
    "_uuid": "8f2839f25d086af736a60e9eeb907d3b93b6e0e5",
    "papermill": {
     "duration": 0.00334,
     "end_time": "2022-08-29T21:16:28.901671",
     "exception": false,
     "start_time": "2022-08-29T21:16:28.898331",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "---\n",
    "title: \"Case1- Cyclistic\"\n",
    "author: \"Shahar Mazur\"\n",
    "date: \"2022-08-24\"\n",
    "output: html_document\n",
    "---\n",
    "###### To manipulate date functions\n",
    "###### To create final visualization\n",
    "###### To calculate distances on the map\n",
    "###### To scale th ggplot\n",
    "\n",
    "knitr::opts_chunk$set(echo = TRUE)\n",
    "\n",
    "\n",
    "\n",
    "install.packages(\"lubridate\") \n",
    "install.packages(\"ggplot2\") \n",
    "install.packages(\"geosphere\") \n",
    "install.packages(\"scales\") \n",
    "install.packages(\"ggmap\")\n",
    "\n",
    "\n",
    "```{r setup, include=FALSE}\n",
    "library(geosphere)\n",
    "library(lubridate)\n",
    "library(ggplot2)\n",
    "library(tidyverse)\n",
    "library(scales)\n",
    "library(ggmap)\n",
    "```\n",
    "\n",
    "# As Im working on my desktop, making sure the working dir.\n",
    "## Setting my data dir \n",
    "```{r}\n",
    "getwd() \n",
    "setwd(\"/Users/mazor/Documents/Case1-Cyclistic/Data\") \n",
    "list.files(path = \"../Data\")\n",
    "```\n",
    "# Reading in the entire Dataset - 1 Year's worth of traveling data\n",
    "```{r}\n",
    "tripdata_202107 <- read.csv(\"../data/202107-divvy-tripdata.csv\")\n",
    "tripdata_202108 <- read.csv(\"../data/202108-divvy-tripdata.csv\")\n",
    "tripdata_202109 <- read.csv(\"../data/202109-divvy-tripdata.csv\")\n",
    "tripdata_202110 <- read.csv(\"../data/202110-divvy-tripdata.csv\")\n",
    "tripdata_202111 <- read.csv(\"../data/202111-divvy-tripdata.csv\")\n",
    "tripdata_202112 <- read.csv(\"../data/202112-divvy-tripdata.csv\")\n",
    "tripdata_202201 <- read.csv(\"../data/202201-divvy-tripdata.csv\")\n",
    "tripdata_202202 <- read.csv(\"../data/202202-divvy-tripdata.csv\")\n",
    "tripdata_202203 <- read.csv(\"../data/202203-divvy-tripdata.csv\")\n",
    "tripdata_202204 <- read.csv(\"../data/202204-divvy-tripdata.csv\")\n",
    "tripdata_202205 <- read.csv(\"../data/202205-divvy-tripdata.csv\")\n",
    "tripdata_202206 <- read.csv(\"../data/202206-divvy-tripdata.csv\")\n",
    "```\n",
    "\n",
    "\n",
    "#.................#\n",
    "#Checking My Data #\n",
    "#.................#\n",
    "# Checking coulmn names are identical before joining all data\n",
    "```{r}\n",
    "colnames(tripdata_202107)\n",
    "colnames(tripdata_202108)\n",
    "colnames(tripdata_202109)\n",
    "colnames(tripdata_202110)\n",
    "colnames(tripdata_202111)\n",
    "colnames(tripdata_202112)   \n",
    "colnames(tripdata_202201)\n",
    "colnames(tripdata_202202)\n",
    "colnames(tripdata_202203)\n",
    "colnames(tripdata_202204)\n",
    "colnames(tripdata_202205)\n",
    "colnames(tripdata_202206)\n",
    "```\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "# Joining all data to one dataset to make future processing more simple\n",
    "```{r}\n",
    "Total_Trip_Data <- bind_rows(tripdata_202107\n",
    "                             ,tripdata_202108\n",
    "                             ,tripdata_202109\n",
    "                             ,tripdata_202110\n",
    "                             ,tripdata_202111\n",
    "                             ,tripdata_202112\n",
    "                             ,tripdata_202201\n",
    "                             ,tripdata_202202\n",
    "                             ,tripdata_202203\n",
    "                             ,tripdata_202204\n",
    "                             ,tripdata_202205\n",
    "                             ,tripdata_202206)\n",
    "```\n",
    "\n",
    "\n",
    "```{r}\n",
    "print(unique(Total_Trip_Data$rideable_type)) \n",
    "```\n",
    "### Consistent with 3 types of bikes - \"docked_bike\"   \"classic_bike\"  \"electric_bike\" - No Nulls\n",
    "```{r}\n",
    "print(unique(Total_Trip_Data$member_casual))          \n",
    "```\n",
    "### Consistent with 2 types of users - \"casual\" \"member\" - No Nulls\n",
    "```{r include=FALSE}\n",
    "print(unique(Total_Trip_Data$start_station_name))                                         \n",
    "print(unique(Total_Trip_Data$end_station_name))\n",
    "```\n",
    "### There are 22 more ending stations than starting stations\n",
    "```{r include=FALSE}\n",
    "print(unique(Total_Trip_Data$start_station_id))\n",
    "print(unique(Total_Trip_Data$end_station_id))\n",
    "```\n",
    "### There are 14 more ending stations ID's than starting ID\n",
    "\n",
    "### Data contain a lot of un-needed data, as charging stations, repair stations, mobile stations .\n",
    "```{r}\n",
    "print(mean(Total_Trip_Data$start_lat))\n",
    "print(mean(Total_Trip_Data$start_lng))\n",
    "print(mean(Total_Trip_Data$end_lat))     \n",
    "print(mean(Total_Trip_Data$end_lng))     \n",
    "```\n",
    "\n",
    "##### mean(Total_Trip_Data$end_lng came out as NA\n",
    "##### mean(Total_Trip_Data$end_lat came out as NA\n",
    "##### A quick check to see if there are NULLs in a numeric data frames\n",
    "##### It shows some of the bikes never arrived to an end station (theft, broke) either way the data will interfere with our results and should be removed.\n",
    "\n",
    "\n",
    "##### 774 bikes has not arrived to an end station by members.\n",
    "##### 3545 bikes has not arrived to an end station by casual users.\n",
    "##### Total of 4319 bikes has not arrived to an end station.\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "# Organizing My Data\n",
    "\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data <- na.omit(Total_Trip_Data) \n",
    "```\n",
    "##### removes all null cells that might interfere with calculations. - Removes 5,374 rows\n",
    "\n",
    "```{r include=FALSE}\n",
    "Total_Trip_Data <- rename(Total_Trip_Data\n",
    "                  ,start_time = \"started_at\"\n",
    "                  ,end_time = \"ended_at\")\n",
    "```\n",
    "\n",
    "### extract year, month, date, day of week .\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data <- Total_Trip_Data %>%\n",
    "  mutate(year = format(as.Date(start_time), \"%Y\")) %>% \n",
    "  mutate(month = format(as.Date(start_time), \"%B\")) %>% \n",
    "  mutate(date = format(as.Date(start_time), \"%d\")) %>% \n",
    "  mutate(day_of_week = format(as.Date(start_time), \"%A\")) %>% \n",
    "  mutate(ride_length = difftime(end_time, start_time))  \n",
    "\n",
    "Total_Trip_Data <- Total_Trip_Data %>%   \n",
    "  mutate(ride_length = as.numeric(ride_length))\n",
    "\n",
    "```\n",
    "### Creating back up\n",
    "```{r eval=FALSE, include=FALSE}\n",
    "Total_Trip_Data -> Total_Trip_Data_temp ## creating back up #1\n",
    "```\n",
    "\n",
    "# Adding a column to calculate each trip duration\n",
    "```{r}\n",
    "Total_Trip_Data <- mutate(Total_Trip_Data, tripduration = int_length(interval(ymd_hms(Total_Trip_Data$start_time), ymd_hms(Total_Trip_Data$end_time))))\n",
    "```\n",
    "\n",
    "# Calculating aerial distance of the trip.\n",
    "```{r}\n",
    "Total_Trip_Data$Ariel_distance <- distGeo(matrix(c(Total_Trip_Data$start_lng, Total_Trip_Data$start_lat), ncol = 2), matrix(c(Total_Trip_Data$end_lng, Total_Trip_Data$end_lat), ncol = 2))\n",
    "\n",
    "\n",
    "Total_Trip_Data <- Total_Trip_Data[!(Total_Trip_Data$Ariel_distance <= 0),]\n",
    "```\n",
    "# Cleaning rides that were picked up and returned to the same station. \n",
    "#### Cleared 366,276 rows (this is a data collection issue)\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data <- Total_Trip_Data[!(Total_Trip_Data$Ariel_distance >=30000),] \n",
    "```\n",
    "## Cleaning  unusual rides, over 30KM  (cleared 10 rows)\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data <- Total_Trip_Data[!(Total_Trip_Data$tripduration <= 0),] \n",
    "```\n",
    "## Cleaning rows with issue as trip duration =<0 , cleared 484 rows\n",
    "\n",
    "\n",
    "# Creating Backup number 2\n",
    "```{r eval=FALSE, include=FALSE}\n",
    "Total_Trip_Data_temp2 <- Total_Trip_Data ## creating back up #2\n",
    "```\n",
    "\n",
    "\n",
    "## Analyzing\n",
    "##### This analize is going to be without assuming casual riders go to touristic spots, in the 2nd analysis wi will remove all casual riders ending stations that are located in a city touristic area so we can consider only local casual riders.\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data %>% \n",
    "  group_by(rideable_type) %>% \n",
    "  summarise(ride_count = length(ride_id), ride_percentage = (length(ride_id) / nrow(Total_Trip_Data)) * 100)\n",
    "```\n",
    "# what is \"docked_bike\" ?\n",
    "### Contacted Divvy , the answer was that Docked_bike are equal to Classic_bike.\n",
    "```{r}\n",
    "Total_Trip_Data['rideable_type'][Total_Trip_Data['rideable_type'] ==\"docked_bike\"] <- \"classic_bike\"\n",
    "print(unique(Total_Trip_Data$rideable_type))\n",
    "```\n",
    "### Corrected to 2 types of bikes -  \"classic_bike\"  \"electric_bike\" - No Nulls\n",
    "\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data %>% \n",
    "  group_by(member_casual) %>% \n",
    "  summarise(ride_count = length(ride_id), ride_percentage = (length(ride_id) / nrow(Total_Trip_Data)) * 100)\n",
    "```\n",
    "\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data %>% \n",
    "  group_by(member_casual) %>% \n",
    "  summarise(longest_ride_MINUTES = max(tripduration/60),Average_ride_MINUTES = mean(tripduration/60),Shortest_ride_MINUTES = min(tripduration/60))\n",
    "```\n",
    "\n",
    "\n",
    "\n",
    "```{r}  \n",
    "Total_Trip_Data %>%\n",
    "ggplot(mapping = aes(x = member_casual, fill=member_casual)) +\n",
    "  geom_bar() +\n",
    "  labs( x=\"Casuals vs Members\", y=\"Number Of Rides\", title= \"Distrebution between Members & Casual users - Tourists included.\",alt = \"User Type\", caption = \"**This dataset contain tourists**\") +\n",
    "  scale_y_continuous(labels = comma) +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\")) +\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  geom_text(aes(label = scales::percent((..count..)/sum(..count..))), stat = \"count\", vjust = 12, colour = \"Black\")\n",
    "```\n",
    "## 42.4%\n",
    "## 57.6%\n",
    "\n",
    "\n",
    "\n",
    "## Sorting \"day_of_week\" by the days of the week \n",
    "```{r}\n",
    "Total_Trip_Data$day_of_week <- factor(Total_Trip_Data$day_of_week, \n",
    "                               levels = as.character(wday(c(2:7,1), label=TRUE, abbr=FALSE)))\n",
    "```\n",
    "\n",
    "## Sorting \"month\" by the months of the year\n",
    "```{r}\n",
    "Total_Trip_Data$month <- factor(Total_Trip_Data$month, \n",
    "                                      levels = as.character(month(c(7:12,1:6), label=TRUE, abbr=FALSE)))\n",
    "```\n",
    "```{r}\n",
    "ggplot(Total_Trip_Data, aes(x=day_of_week,fill = member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  scale_y_continuous(labels = comma)+\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  labs( x=\"Day Of The Week\", y=\"Number Of Rides\", title= \"Members & Casual users use by day of the week - With Tourists\",alt = \"User Type\", caption = \"**This dataset contain tourists**\") +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\"))\n",
    "```\n",
    "```{r}\n",
    "ggplot(Total_Trip_Data, aes(x=month,fill = member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  scale_y_continuous(labels = comma)+\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\")) +\n",
    "  labs(x=\"July 2021 to June 2022\", y=\"Number Of Rides\", title= \"Members & Casual users use by month.\",caption = \"**This dataset contain tourists**\")\n",
    "```\n",
    "\n",
    "\n",
    "### Analyzing these 2 tablets shows us there are too many tourists in the dataset, and the should not be considered in the research.\n",
    "\n",
    "# Creating a backup for the cleaning process\n",
    "```{r}\n",
    "Total_Trip_Data -> Total_Trip_Data_temp2\n",
    "write.csv(Total_Trip_Data,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\Final_Dataset_with_tourists.csv\", row.names = FALSE)\n",
    "```\n",
    "\n",
    "# Removing stations that are considered by the company as \" for tourism\"\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists <- Total_Trip_Data[!(Total_Trip_Data$end_station_name==\"Streeter Dr & Grand Ave\" \n",
    "                                                  | Total_Trip_Data$end_station_name==\"Ft Dearborn Dr & 31st St\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"South Shore Dr & 71st St\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Museum of Science and Industry\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Shore Dr & 55th St\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Fort Dearborn Dr & 31st St\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Burnham Harbor\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Shedd Aquarium\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Field Museum\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Adler Planetarium\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Lake Shore Dr & Monroe St\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"DuSable Harbor\"\n",
    "                                                  | Total_Trip_Data$end_station_name==\"Lake Park Ave & 53rd St\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Lake Shore Dr & North Blvd\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Clark St & Armitage Ave\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Cannon Dr & Fullerton Ave\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Lake Shore Dr & Belmont Ave\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Montrose Harbor\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Michigan Ave & Oak St\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Marshfield Ave & Courtland St\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Damen Ave & Courtland St\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Milwaukee Ave & Wabansia St\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Western Ave & Winnebago Ave\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Albany Ave & Bloomingdale Ave\"\n",
    "                                                 | Total_Trip_Data$end_station_name==\"Theater on the Lake\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Streeter Dr & Grand Ave\" \n",
    "                                                 | Total_Trip_Data$start_station_name==\"Ft Dearborn Dr & 31st St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"South Shore Dr & 71st St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Museum of Science and Industry\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Shore Dr & 55th St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Fort Dearborn Dr & 31st St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Burnham Harbor\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Shedd Aquarium\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Field Museum\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Adler Planetarium\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Lake Shore Dr & Monroe St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"DuSable Harbor\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Lake Park Ave & 53rd St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Lake Shore Dr & North Blvd\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Clark St & Armitage Ave\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Cannon Dr & Fullerton Ave\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Lake Shore Dr & Belmont Ave\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Montrose Harbor\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Michigan Ave & Oak St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Marshfield Ave & Courtland St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Damen Ave & Courtland St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Milwaukee Ave & Wabansia St\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Western Ave & Winnebago Ave\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Albany Ave & Bloomingdale Ave\"\n",
    "                                                 | Total_Trip_Data$start_station_name==\"Theater on the Lake\"),]\n",
    "```\n",
    "### Removing these stations that are considered as \"touristic\" removed 569,940 rows, can assume there are more tourists that that a year. but personal information is needed to make sure.\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists <- Total_Trip_Data_no_tourists[!(Total_Trip_Data_no_tourists$Ariel_distance >=30000),] \n",
    "Total_Trip_Data_no_tourists <- Total_Trip_Data_no_tourists[!(Total_Trip_Data_no_tourists$tripduration <= 0),]\n",
    "```\n",
    "\n",
    "\n",
    "#### This is the last version and change to the dataframe, I work on a laptop so to clear out memory space I will export my dataset into a CSV file, clear the workframe are from old datasets and re-load only what I need for graphic use.\n",
    "\n",
    "# Backup and reload section\n",
    "write.csv(Total_Trip_Data_no_tourists,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\Final_Dataset_Without_Tourists_bystation.csv\", row.names = FALSE)\n",
    "Total_Trip_Data_no_tourists <- read.csv(\"../Data/Final_Dataset_Without_Tourists_bystation.csv\") ## ## Don't forget to load libraries.\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists %>% \n",
    "  group_by(member_casual) %>% \n",
    "  summarise(ride_count = length(ride_id), ride_percentage = (length(ride_id) / nrow(Total_Trip_Data_no_tourists)) * 100)\n",
    "```\n",
    "\n",
    "# Significant change from earlier results \n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists %>% \n",
    "  group_by(member_casual) %>% \n",
    "  summarise(longest_ride_MINUTES = max(tripduration/60),Average_ride_MINUTES = mean(tripduration/60),Shortest_ride_MINUTES = min(tripduration/60))\n",
    "```\n",
    "\n",
    "\n",
    "# Starting to plot the data\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists %>%\n",
    "  ggplot(mapping = aes(x = member_casual, fill=member_casual)) +\n",
    "  geom_bar() +\n",
    "  labs( x=\"Casuals vs Members\", y=\"Number Of Rides\", title= \"Distrebution between Members & Casual users - Without tourists.\",alt = \"User Type\", caption = \"**This dataset contain NO tourists**\") +\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  scale_y_continuous(labels = comma) +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\"))+\n",
    "  geom_text(aes(label = scales::percent((..count..)/sum(..count..))), stat = \"count\", vjust = 12, colour = \"Black\")\n",
    "```\n",
    "\n",
    "\n",
    "## 40.1%\n",
    "## 59.9%\n",
    "\n",
    "## Sorting \"day_of_week\" by the days of the week \n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists$day_of_week <- factor(Total_Trip_Data_no_tourists$day_of_week, \n",
    "                                      levels = as.character(wday(c(2:7,1), label=TRUE, abbr=FALSE)))\n",
    "```\n",
    "\n",
    "## Sorting \"month\" by the months of the year\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists$month <- factor(Total_Trip_Data_no_tourists$month, \n",
    "                                levels = as.character(month(c(7:12,1:6), label=TRUE, abbr=FALSE)))\n",
    "```\n",
    "\n",
    "```{r}\n",
    "ggplot(Total_Trip_Data_no_tourists, aes(x=rideable_type,fill = member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  scale_y_continuous(labels = comma)+\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\")) +\n",
    "  labs(x=\"Bike Type\", y=\"Number Of Rides\", title= \"Members & Casual users use by type of bike.\",caption = \"**This dataset contain NO tourists**\")\n",
    "\n",
    "ggplot(Total_Trip_Data_no_tourists, aes(x=day_of_week,fill = member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  scale_y_continuous(labels = comma)+\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  labs( x=\"Day Of The Week\", y=\"Number Of Rides\", title= \"Members & Casual users use by day of the week - Without Tourists\",alt = \"User Type\", caption = \"**This dataset contain NO tourists**\") +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\"))\n",
    "\n",
    "\n",
    "\n",
    "ggplot(Total_Trip_Data_no_tourists, aes(x=month,fill = member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  scale_y_continuous(labels = comma)+\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\")) +\n",
    "  labs(x=\"July 2021 to June 2022\", y=\"Number Of Rides\", title= \"Members & Casual users use by month.\",caption = \"**This dataset contain NO tourists**\")\n",
    "```\n",
    "\n",
    "backup point\n",
    "Total_Trip_Data_temp3 <- Total_Trip_Data_no_tourists ## back up\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "```{r}\n",
    "Total_Trip_Data_no_tourists$hour <-format(as.POSIXct(Total_Trip_Data_no_tourists$start_time), format = \"%H\")\n",
    "\n",
    "\n",
    "Total_Trip_Data_no_tourists %>%\n",
    "  ggplot(aes(x=hour, fill=member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  labs(x=\"Hour of the day\", title=\"Cyclistic's bike demand per hour by day of the week\") +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\")) +\n",
    "  facet_wrap(~ day_of_week)\n",
    "\n",
    "\n",
    "Examin_weekdays <- Total_Trip_Data_no_tourists[!((Total_Trip_Data_no_tourists$day_of_week ==\"Sunday\") |(Total_Trip_Data_no_tourists$day_of_week ==\"Saturday\")),]\n",
    "```\n",
    "## Needed to show weekend vs weekdays example\n",
    "```{r}\n",
    "Examin_weekdays %>%\n",
    "  ggplot(aes(x=hour, fill=member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  labs(x=\"Hour of the day\", title=\"Cyclistic's bike demand per hour on the weekdays\") +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\"))+\n",
    "  facet_wrap(~ day_of_week,nrow =2)\n",
    "\n",
    "\n",
    "Examin_weekend <- Total_Trip_Data_no_tourists[(Total_Trip_Data_no_tourists$day_of_week ==\"Sunday\") |(Total_Trip_Data_no_tourists$day_of_week ==\"Saturday\"),]\n",
    "\n",
    "Examin_weekend %>%\n",
    "  ggplot(aes(x=hour, fill=member_casual)) +\n",
    "  geom_bar(position = \"dodge\") +\n",
    "  theme(plot.title = element_text(hjust = 0.5)) +\n",
    "  labs(x=\"Hour of the day\", title=\"Cyclistic's bike demand per hour on the weekend\") +\n",
    "  scale_fill_manual(\"legend\", values = c(\"member\" = \"#62B2E0\", \"casual\" = \"#E06287\"))+\n",
    "  facet_wrap(~ day_of_week)\n",
    "```\n",
    "# Exporting files to use in Power BI\n",
    "```{r}\n",
    "write.csv(Examin_weekend,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\examine_weekends.csv\", row.names = FALSE)\n",
    "write.csv(Examin_weekdays,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\Examin_weekdays.csv\", row.names = FALSE)\n",
    "```\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "### Lets check the coordinates data of the rides.\n",
    "### Adding a new data frame only for the most popular routes >150 rides\n",
    "### as we are comparing we should first split betwenn members and casual users then look at the 150 most driven routes\n",
    "```{r}\n",
    "casual_riders_dt <- Total_Trip_Data_no_tourists %>% filter(member_casual == \"casual\")\n",
    "member_riders_dt <- Total_Trip_Data_no_tourists %>% filter(member_casual == \"member\")\n",
    "```\n",
    "### Exporting files to use in Power BI\n",
    "```{r}\n",
    "write.csv(casual_riders_dt,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\casual_riders_dt.csv\", row.names = FALSE)\n",
    "write.csv(member_riders_dt,\"C:\\\\Users\\\\mazor\\\\Documents\\\\Case1-Cyclistic\\\\Data\\\\member_riders_dt.csv\", row.names = FALSE)\n",
    "```\n",
    "\n",
    "```{r}\n",
    "casual_riders <- casual_riders_dt %>% \n",
    "  filter(start_lng != end_lng & start_lat != end_lat) %>%\n",
    "  group_by(start_lng, start_lat, end_lng, end_lat, member_casual, Ariel_distance,rideable_type) %>%\n",
    "  summarise(total_rides = n(),.groups=\"drop\") %>%\n",
    "  filter(total_rides > 150)\n",
    "\n",
    "member_riders <- member_riders_dt %>% \n",
    "  filter(start_lng != end_lng & start_lat != end_lat) %>%\n",
    "  group_by(start_lng, start_lat, end_lng, end_lat, member_casual, Ariel_distance,rideable_type) %>%\n",
    "  summarise(total_rides = n(),.groups=\"drop\") %>%\n",
    "  filter(total_rides > 150)\n",
    "```\n",
    "\n",
    "\n",
    "# now lets create two different data frames depending on rider type (member_casual)\n",
    "\n",
    "```{r}\n",
    "chicago <- c(left = -87.700424, bottom = 41.74, right = -87.554855, top = 42.04)\n",
    "\n",
    "chicago_map <- get_stamenmap(bbox = chicago, zoom = 12, maptype = \"terrain\")\n",
    "\n",
    "total_ride_colors <- colorRampPalette(c(\"blue\",\"green\"))\n",
    "favorite <- total_ride_colors(200)\n",
    "```\n",
    "\n",
    "# Maps on casual riders\n",
    "```{r}\n",
    "ggmap(chicago_map,darken = c(0.1, \"white\")) +\n",
    "  geom_point(casual_riders, mapping = aes(x = start_lng, y = start_lat, color=total_rides), size = 2) +\n",
    "  coord_fixed(0.8) +\n",
    "  scale_colour_gradientn(colors = favorite)+\n",
    "  labs(title = \"Most used routes by Casual riders\",x=NULL,y=NULL)\n",
    "```\n",
    "\n",
    "# Map on member riders\n",
    "```{r}\n",
    "ggmap(chicago_map,darken = c(0.1, \"white\")) +\n",
    "  geom_point(member_riders, mapping = aes(x = start_lng, y = start_lat, color=total_rides), size = 2) +  \n",
    "  coord_fixed(0.8) +\n",
    "  scale_colour_gradientn(colors = favorite)+\n",
    "  labs(title = \"Most used routes by Member riders\",x=NULL,y=NULL)\n",
    "```\n",
    "\n",
    "\n",
    "\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "R",
   "language": "R",
   "name": "ir"
  },
  "language_info": {
   "codemirror_mode": "r",
   "file_extension": ".r",
   "mimetype": "text/x-r-source",
   "name": "R",
   "pygments_lexer": "r",
   "version": "4.0.5"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 3.633068,
   "end_time": "2022-08-29T21:16:29.025473",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2022-08-29T21:16:25.392405",
   "version": "2.3.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
